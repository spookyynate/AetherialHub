-- Check if Drawing API is available
local function API_Check()
    if Drawing == nil then
        return "No"
    else
        return "Yes"
    end
end

local Find_Required = API_Check()

if Find_Required == "No" then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Aetherial Hub";
        Text = "Script could not load because of your executor.";
        Duration = math.huge;
        Button1 = "OK"
    })
    return
end

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Camera = game:GetService("Workspace").CurrentCamera
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local Typing = false
local ESPEnabled = true  -- Variable to manage the ESP toggle state

-- Define default settings
local defaultSettings = {
    ESPKey = Enum.KeyCode.E -- Default key for toggling ESP
}

_G.SendNotifications = true
_G.ESPKey = defaultSettings.ESPKey

-- Create the GUI
local screenGui = Instance.new("ScreenGui")
local frame = Instance.new("Frame")
local espKeyLabel = Instance.new("TextLabel")
local espKeyInput = Instance.new("TextBox")
local applyButton = Instance.new("TextButton")

screenGui.Name = "AetherialHubGUI"
screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

frame.Size = UDim2.new(0, 300, 0, 150)
frame.Position = UDim2.new(0.5, -150, 0.5, -75)
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.Parent = screenGui

espKeyLabel.Size = UDim2.new(0, 150, 0, 50)
espKeyLabel.Position = UDim2.new(0.1, 0, 0.2, 0)
espKeyLabel.Text = "ESP Key:"
espKeyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
espKeyLabel.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
espKeyLabel.Parent = frame

espKeyInput.Size = UDim2.new(0, 100, 0, 50)
espKeyInput.Position = UDim2.new(0.5, -50, 0.2, 0)
espKeyInput.Text = _G.ESPKey.Name
espKeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
espKeyInput.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
espKeyInput.Parent = frame

applyButton.Size = UDim2.new(0, 100, 0, 50)
applyButton.Position = UDim2.new(0.5, -50, 0.8, 0)
applyButton.Text = "Apply"
applyButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
applyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
applyButton.Parent = frame

-- Function to convert key name to Enum.KeyCode
local function getKeyCodeFromName(keyName)
    for _, keyCode in pairs(Enum.KeyCode:GetEnumItems()) do
        if keyCode.Name == keyName then
            return keyCode
        end
    end
    return nil
end

-- Function to apply the new key settings
local function applyKeySettings()
    local espKey = getKeyCodeFromName(espKeyInput.Text)
    
    if espKey then
        _G.ESPKey = espKey
        StarterGui:SetCore("SendNotification", {
            Title = "Aetherial Hub",
            Text = "ESP Key updated to: " .. _G.ESPKey.Name,
            Duration = 5,
        })
    else
        StarterGui:SetCore("SendNotification", {
            Title = "Aetherial Hub",
            Text = "Invalid ESP Key. Please enter a valid key.",
            Duration = 5,
        })
    end
end

-- Connect input events
applyButton.MouseButton1Click:Connect(applyKeySettings)

-- Update GUI with default key values
espKeyInput.Text = _G.ESPKey.Name

-- Key input handler
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == _G.ESPKey then
        ESPEnabled = not ESPEnabled
        
        if ESPEnabled then
            -- Show ESP
            -- Add your ESP logic here
            StarterGui:SetCore("SendNotification", {
                Title = "Aetherial Hub",
                Text = "ESP Enabled.",
                Duration = 5,
            })
        else
            -- Hide ESP
            -- Add your ESP hide logic here
            StarterGui:SetCore("SendNotification", {
                Title = "Aetherial Hub",
                Text = "ESP Disabled.",
                Duration = 5,
            })
        end
    end
end)

local function CreateESP()
    -- Your existing ESP creation code goes here
end

UserInputService.TextBoxFocused:Connect(function()
    Typing = true
end)

UserInputService.TextBoxFocusReleased:Connect(function()
    Typing = false
end)

local Success, Errored = pcall(function()
    CreateESP()
end)

if Success and not Errored then
    if _G.SendNotifications then
        StarterGui:SetCore("SendNotification", {
            Title = "Aetherial Hub";
            Text = "ESP script has successfully loaded.";
            Duration = 5;
        })
    end
elseif Errored and not Success then
    if _G.SendNotifications then
        StarterGui:SetCore("SendNotification", {
            Title = "Aetherial Hub";
            Text = "ESP script has errored while loading, please check the developer console! (F9)";
            Duration = 5;
        })
    end
    warn(Errored)
end
